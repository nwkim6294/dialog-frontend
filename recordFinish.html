<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회의 마무리 - AI 회의록 서비스</title>
    <link rel="stylesheet" href="./static/css/style.css">
    <link rel="stylesheet" href="./static/css/recordFinish.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar Trigger Zone -->
        <div class="sidebar-trigger"></div>

        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div id="recordFinish" class="content-wrapper">
                
                <!-- 헤더 -->
                <div class="rcf-header">
                    <div class="rcf-header-top">
                        <div class="page-header">
                            <h2 class="meeting-title" onclick="editMeetingTitle()" id="meetingTitle">프로젝트 기획 회의</h2>
                        </div>
                        <div class="header-actions">
                            <div class="dropdown-wrapper">
                                <button class="btn btn-secondary" onclick="toggleDropdown()" id="downloadBtn">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7 10 12 15 17 10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                </button>
                                <div class="dropdown-menu" id="downloadDropdown">
                                    <div class="dropdown-item" onclick="exportJSON()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                            <polyline points="13 2 13 9 20 9"/>
                                        </svg>
                                        JSON 파일
                                    </div>
                                    <div class="dropdown-item" onclick="exportPDF()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                            <polyline points="14 2 14 8 20 8"/>
                                        </svg>
                                        PDF 파일
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-success" onclick="saveMeeting()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                저장 및 완료
                            </button>
                        </div>
                    </div>
                    <div class="meeting-meta">
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            <span id="meetingDate">2025.10.10 14:00</span>
                        </div>
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            <span id="meetingDuration">00:45:23</span>
                        </div>
                        <div class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            <span id="participantCount">3명 참석</span>
                        </div>
                    </div>
                </div>

                <!-- 메인 레이아웃 -->
                <div class="rf-main-wrapper">
                    <!-- 메인 컨텐츠: 실시간 변환 로그 -->
                    <div class="main-area">
                        <div class="area-header">
                            <h2 class="area-title">실시간 변환 로그</h2>
                            <button class="btn btn-secondary btn-sm" onclick="openAddTranscriptModal()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                발화 추가
                            </button>
                        </div>

                        <div class="area-meta">
                            <span id="transcriptCount">이 15개 발화</span>
                            <span>•</span>
                            <span id="mappingStatus">0/5 매핑 완료</span>
                            <span>•</span>
                            <span class="chart-link" onclick="openParticipationChart()">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 20V10"/>
                                    <path d="M12 20V4"/>
                                    <path d="M6 20v-6"/>
                                </svg>
                                발화 점유율
                            </span>
                        </div>

                        <div class="transcript-area">
                            <div class="transcript-list" id="transcriptList">
                                <!-- 발화 로그가 동적으로 추가됩니다 -->
                            </div>
                        </div>
                    </div>

                    <!-- 사이드바 -->
                    <div class="content-sidebar">
                        <!-- AI 요약 -->
                        <div class="sidebar-section">
                            <div class="area-header">
                                <h3 class="sidebar-title">AI 요약</h3>
                                <button class="edit-btn" id="toggleEditBtn" onclick="toggleSummaryEdit()" disabled>
                                    <span id="editBtnText">편집</span>
                                </button>
                                <button class="btn btn-primary btn-sm" id="generateSummaryBtn" onclick="startFullSummaryGeneration()" style="margin-left: 8px;" disabled>
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                    </svg>
                                    AI 요약 생성
                                </button>
                            </div>

                            <div class="summary-block">
                                <div class="summary-label">회의 목적</div>
                                <div class="summary-text" id="purposeView">프로젝트 방향성 논의 및 세부 일정 수립</div>
                                <textarea class="summary-editor hidden" id="purposeEditor" placeholder="회의 목적을 입력하세요"></textarea>
                            </div>

                            <div class="summary-block">
                                <div class="summary-label">주요 안건</div>
                                <div class="summary-text" id="agendaView">예산 배정, 일정 조율, 역할 분담</div>
                                <textarea class="summary-editor hidden" id="agendaEditor" placeholder="주요 안건을 입력하세요"></textarea>
                            </div>

                            <div class="summary-block">
                                <div class="summary-label">전체 요약</div>
                                <div class="summary-text" id="summaryView">이번 회의에서는 프로젝트의 주요 목표와 일정에 대해 논의했습니다. 예산안 검토 및 각 팀원의 역할 분담이 이루어졌으며, 다음 주까지 세부 일정을 확정하기로 했습니다.</div>
                                <textarea class="summary-editor hidden" id="summaryEditor" placeholder="전체 요약을 입력하세요"></textarea>
                            </div>

                            <div class="summary-block" id="importanceBlock">
                                <div class="summary-label">⭐ 회의 중요도</div>
                                <div class="summary-text">
                                    <span id="importanceLevel" style="font-weight: 600; color: #8E44AD;"></span>
                                    <div id="importanceReason" style="margin-top: 4px; color: #6b7280;"></div>
                                </div>
                                <textarea class="summary-editor hidden" id="importanceEditor"></textarea>
                            </div>

                            <div class="edit-actions hidden" id="editActions">
                                <button class="btn btn-secondary" onclick="cancelSummaryEdit()">취소</button>
                                <button class="btn btn-primary" onclick="saveSummaryEdit()">저장</button>
                            </div>
                        </div>

                        <!-- 하이라이트 키워드 -->
                        <div class="sidebar-section">
                            <div class="area-header" style="margin-bottom: 16px;">
                                <h3 class="sidebar-title" style="margin-bottom: 0;">하이라이트 키워드</h3>
                                <button class="btn btn-secondary btn-sm" onclick="openKeywordModal()" style="margin-left: auto;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"/>
                                        <line x1="5" y1="12" x2="19" y2="12"/>
                                    </svg>
                                    키워드 관리
                                </button>
                            </div>
                            <div class="keywords" id="keywords">
                                <div class="keyword" onclick="toggleKeyword(this)">예산</div>
                                <div class="keyword" onclick="toggleKeyword(this)">일정</div>
                                <div class="keyword" onclick="toggleKeyword(this)">역할</div>
                                <div class="keyword" onclick="toggleKeyword(this)">검토</div>
                            </div>
                        </div>

                        <!-- 액션 아이템 -->
                        <div class="sidebar-section">
                            <div class="action-header">
                                <h3 class="sidebar-title">액션 아이템</h3>
                                <div class="action-controls">
                                    <button id="extractMyActionsBtn" class="btn btn-sm btn-secondary" onclick="extractMyActions()" disabled>
                                        내 할 일 추출
                                    </button>
                                </div>
                            </div>

                            <p class="action-info" id="actionInfoText">
                                💡 발화자 매핑 후 내 할 일을 자동 추출할 수 있습니다
                            </p>

                            <div id="actionList">
                            <!-- 액션 아이템이 동적으로 추가됩니다 -->
                            </div>
                            <button class="add-action-btn" onclick="openActionModal()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                액션 아이템 추가
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 제목 모달 -->
            <div id="titleModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">회의 제목 수정</h3>
                    <p class="modal-desc">새로운 회의 제목을 입력하세요.</p>
                </div>
                <div class="modal-body">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">회의 제목</label>
                        <input type="text" id="newTitleInput" class="form-input">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeTitleModal()">취소</button>
                    <button class="btn btn-primary" onclick="saveNewTitle()">저장</button>
                </div>
            </div>
            </div>

            <!-- 발화자 매핑 모달 -->
            <div id="speakerModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">발화자 매핑</h3>
                        <p class="modal-desc">이 발화자를 어떤 참석자와 연결하시겠습니까?</p>
                    </div>
                    <div class="modal-body">
                        <div id="participantList">
                        <!-- 참석자 목록이 동적으로 추가됩니다 -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeSpeakerModal()">취소</button>
                        <button class="btn btn-primary" onclick="saveSpeakerMapping()">확인</button>
                    </div>
                </div>
            </div>

            <!-- 발화 점유율 차트 모달 -->
            <div id="chartModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">발화 점유율</h3>
                        <p class="modal-desc">참석자별 발화 비율을 확인하세요</p>
                    </div>
                    <div class="modal-body">
                        <div id="chartContainer">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="closeChartModal()">확인</button>
                    </div>
                </div>
            </div>

            <!-- 액션 아이템 추가 모달 -->
            <div id="actionModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">액션 아이템 추가</h3>
                        <p class="modal-desc">할 일의 상세 정보를 입력해주세요</p>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">액션 아이템 <span style="color: #ef4444;">*</span></label>
                            <textarea id="actionTitle" class="form-textarea" placeholder="예: 예산안 작성 및 검토"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">담당자</label>
                                <select id="actionAssignee" class="form-select">
                                    <option value="">선택하세요</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">기한</label>
                                <input type="date" id="actionDeadline" class="form-input">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeActionModal()">취소</button>
                        <button class="btn btn-primary" onclick="saveAction()">추가</button>
                    </div>
                </div>
            </div>

            <div id="keywordModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">키워드 관리</h3>
                        <p class="modal-desc">키워드를 직접 추가하거나 삭제합니다.</p>
                    </div>
                    <div class="modal-body">
                        <div class="keyword-add-form" style="margin-top: 0; padding-top: 0; border-top: none;">
                            <input type="text" id="modalKeywordInput" placeholder="키워드 직접 추가...">
                            <button onclick="addManualKeywordFromModal()">추가</button>
                        </div>
                        <hr class="modal-divider">
                        <div class="keywords-manage-list" id="keywordManageList">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="closeKeywordModal()">확인</button>
                    </div>
                </div>
            </div>

            <div id="confirmModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="confirmTitle">삭제 확인</h3>
                    </div>
                    <div class="modal-body">
                        <p id="confirmMessage" style="font-size: 15px; line-height: 1.7;"></p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="confirmCancelBtn">취소</button>
                        <button class="btn btn-danger" id="confirmOkBtn">확인</button> </div>
                </div>
            </div>

            <div id="addTranscriptModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">발화 로그 추가</h3>
                        <p class="modal-desc">새로운 발화 로그 정보를 입력하세요.</p>
                    </div>
                    <div class="modal-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">발화자 <span style="color: #ef4444;">*</span></label>
                                <select id="newTranscriptSpeaker" class="form-select">
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">시간 <span style="color: #ef4444;">*</span></label>
                                <input type="text" id="newTranscriptTime" class="form-input" placeholder="예: 00:15:30">
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">내용 <span style="color: #ef4444;">*</span></label>
                            <textarea id="newTranscriptText" class="form-textarea" placeholder="발화 내용을 입력하세요..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeAddTranscriptModal()">취소</button>
                        <button class="btn btn-primary" onclick="saveNewTranscript()">추가</button>
                    </div>
                </div>
            </div>

            <div id="chatbot-container"></div>

        <!-- 플로팅 버튼 -->
        <button class="floating-chat-btn" id="floatingChatBtn">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
        </button>
      </div>
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="./static/js/app.js"></script>
    <script src="./static/js/lib/jspdf.umd.min.js"></script>
    <script src="./static/js/recordFinish.js"></script>
</body>
</html>